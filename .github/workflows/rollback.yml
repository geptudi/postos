name: Rollback Deployment
on:
  workflow_call:

permissions:
  contents: write

jobs:
  rollback:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout gh-pages
        uses: actions/checkout@v3
        with:
          ref: gh-pages
          fetch-depth: 2  # pega o commit atual + o anterior

      - name: Identificar commit anterior
        id: prev
        run: |
          PREV=$(git rev-parse HEAD~1)
          echo "prev_commit=$PREV" >> $GITHUB_OUTPUT
          echo "Commit anterior: $PREV"

      - name: Reset para commit anterior
        run: |
          git reset --hard ${{ steps.prev.outputs.prev_commit }}
          git push origin gh-pages --force

      - name: Finalizado
        run: |
          echo "Rollback feito com sucesso! Vers√£o anterior restaurada."
